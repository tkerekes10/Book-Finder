"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),r=require("@react-three/fiber"),t=require("three"),n=require("./OrthographicCamera.cjs.js"),u=require("./useCamera.cjs.js");function o(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(t){if("default"!==t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}})),r.default=e,Object.freeze(r)}require("@babel/runtime/helpers/extends"),require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),require("react-merge-refs");var a=o(e),i=a.createContext({}),c=2*Math.PI,s=new t.Object3D,l=new t.Matrix4,f=new t.Quaternion,p=new t.Quaternion,d=new t.Vector3,h=new t.Vector3,m=new t.Quaternion;exports.GizmoHelper=function(e){var o=e.alignment,g=void 0===o?"bottom-right":o,b=e.margin,v=void 0===b?[80,80]:b,w=e.onUpdate,j=e.onTarget,y=e.children,q=r.useThree((function(e){return e.size})),x=r.useThree((function(e){return e.camera})),T=r.useThree((function(e){return e.controls})),O=r.useThree((function(e){return e.gl})),k=r.useThree((function(e){return e.scene})),C=r.useThree((function(e){return e.invalidate})),P=a.useRef(),R=a.useRef(),M=a.useRef(null),E=a.useState((function(){return new t.Scene}))[0],z=a.useRef(!1),D=a.useRef(0),Q=a.useRef(new t.Vector3(0,0,0));a.useEffect((function(){return k.background&&(P.current=k.background,k.background=null,E.background=P.current),function(){P.current&&(k.background=P.current)}}),[]);r.useFrame((function(e,r){var t;M.current&&R.current&&(!function(e){if(C(),z.current){var r=e*c;f.rotateTowards(p,r),x.position.set(0,0,1).applyQuaternion(f).multiplyScalar(D.current).add(Q.current),x.quaternion.rotateTowards(m,r),x.updateProjectionMatrix(),w?w():T&&T.update(),f.angleTo(p)<.01&&(z.current=!1)}}(r),l.copy(x.matrix).invert(),null==(t=R.current)||t.quaternion.setFromRotationMatrix(l),O.autoClear=!1,O.clearDepth(),O.render(E,M.current))}));var S={tweenCamera:function(e){z.current=!0,(T||j)&&(Q.current=(null==T?void 0:T.target)||(null==j?void 0:j())),D.current=x.position.distanceTo(d),s.position.copy(d),s.lookAt(x.position),f.copy(s.quaternion),h.copy(e).multiplyScalar(D.current).add(d),s.lookAt(h),p.copy(s.quaternion),C()},raycast:u.useCamera(M)},_=v[0],V=v[1],W=g.endsWith("-left")?-q.width/2+_:q.width/2-_,A=g.startsWith("top-")?q.height/2-V:-q.height/2+V;return r.createPortal(a.createElement(i.Provider,{value:S},a.createElement(n.OrthographicCamera,{ref:M,makeDefault:!1,position:[0,0,200]}),a.createElement("group",{ref:R,position:[W,A,0]},y)),E)},exports.useGizmoContext=function(){return a.useContext(i)};
